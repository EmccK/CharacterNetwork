{
  "module_info": {
    "name": "管理员模块",
    "description": "系统管理功能，包括用户管理、数据统计和系统监控",
    "route_prefix": "/api/admin",
    "dependencies": ["认证管理模块"]
  },
  "folder": {
    "name": "管理员模块",
    "description": "### 管理员模块\n\n#### 业务逻辑\n- 用户管理和权限控制\n- 系统数据统计和分析\n- 内容审核和管理\n- 系统监控和维护\n- 数据导出和备份\n- 违规内容处理\n\n#### 业务约束\n- 仅限管理员用户访问\n- 所有操作都有详细日志记录\n- 敏感操作需要二次确认\n- 数据修改有审计追踪\n- 批量操作有数量限制\n\n#### 权限控制\n- 需要管理员权限才能访问\n- 不同级别管理员有不同权限\n- 超级管理员拥有所有权限\n- 操作日志完整记录",
    "item": [
      {
        "name": "获取系统统计信息",
        "request": {
          "method": "GET",
          "header": [],
          "url": {
            "raw": "{{base_url}}/api/admin/stats"
          },
          "description": "#### 获取系统统计信息\n\n**功能说明**: 获取系统的整体统计数据，包括用户、小说、角色等各项指标\n\n**权限要求**: \n- 角色：管理员\n- 权限：需要管理员权限\n\n**限流规则**: \n- QPS限制：20次/秒\n- 管理员专用接口\n\n**错误码对照表**:\n\n| 错误码 | HTTP状态码 | 错误信息 | 解决方案 |\n|--------|------------|----------|----------|\n| 401 | 401 | 未登录 | 管理员需要先登录 |\n| 403 | 403 | 权限不足 | 需要管理员权限 |\n| 500 | 500 | 服务器内部错误 | 联系技术支持 |\n\n**业务规则**:\n- 只有管理员可以访问\n- 返回实时统计数据\n- 包含各项核心指标\n- 数据按时间维度分组"
        },
        "response": [
          {
            "name": "获取成功",
            "originalRequest": {
              "method": "GET",
              "header": [],
              "url": {
                "raw": "{{base_url}}/api/admin/stats"
              }
            },
            "status": "OK",
            "code": 200,
            "_postman_previewlanguage": "json",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "cookie": [],
            "body": "{\n  \"users\": {\n    \"total\": 1250,\n    \"active\": 890,\n    \"newThisMonth\": 45,\n    \"adminCount\": 3\n  },\n  \"novels\": {\n    \"total\": 3420,\n    \"published\": 2890,\n    \"inProgress\": 1680,\n    \"completed\": 1210,\n    \"newThisWeek\": 28\n  },\n  \"characters\": {\n    \"total\": 15680,\n    \"withAvatar\": 8920,\n    \"averagePerNovel\": 4.6\n  },\n  \"relationships\": {\n    \"total\": 28450,\n    \"byType\": {\n      \"朋友\": 8920,\n      \"敌人\": 5670,\n      \"恋人\": 3450,\n      \"亲人\": 4210,\n      \"师徒\": 2890,\n      \"其他\": 3310\n    }\n  },\n  \"notes\": {\n    \"total\": 12340,\n    \"withTags\": 9870,\n    \"averageLength\": 245\n  },\n  \"timelineEvents\": {\n    \"total\": 8920,\n    \"byImportance\": {\n      \"critical\": 890,\n      \"important\": 2340,\n      \"normal\": 4560,\n      \"minor\": 1130\n    }\n  },\n  \"system\": {\n    \"uptime\": \"15天 8小时 32分钟\",\n    \"lastBackup\": \"2024-01-15T02:00:00.000Z\",\n    \"diskUsage\": \"68%\",\n    \"memoryUsage\": \"45%\"\n  }\n}",
            "description": "### 系统统计信息成功响应\n\n**响应字段**:\n\n| 分类 | 字段名 | 类型 | 描述 |\n|------|--------|------|------|\n| users | total | number | 总用户数 |\n| users | active | number | 活跃用户数 |\n| users | newThisMonth | number | 本月新增用户 |\n| users | adminCount | number | 管理员数量 |\n| novels | total | number | 总小说数 |\n| novels | published | number | 已发布小说数 |\n| novels | inProgress | number | 进行中小说数 |\n| novels | completed | number | 已完成小说数 |\n| characters | total | number | 总角色数 |\n| relationships | total | number | 总关系数 |\n| relationships | byType | object | 按类型分组的关系统计 |\n| system | uptime | string | 系统运行时间 |\n| system | diskUsage | string | 磁盘使用率 |"
          },
          {
            "name": "权限不足",
            "originalRequest": {
              "method": "GET",
              "header": [],
              "url": {
                "raw": "{{base_url}}/api/admin/stats"
              }
            },
            "status": "Forbidden",
            "code": 403,
            "_postman_previewlanguage": "json",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "cookie": [],
            "body": "{\n  \"message\": \"Access denied. Admin privileges required.\"\n}",
            "description": "### 权限不足错误响应\n\n**触发条件**:\n- 用户不是管理员\n- 管理员权限被撤销\n- 会话过期\n\n**处理建议**:\n- 确认用户具有管理员权限\n- 重新登录获取最新权限\n- 联系超级管理员"
          }
        ],
        "event": [
          {
            "listen": "prerequest",
            "script": {
              "exec": [
                "// 检查登录状态和管理员权限",
                "if (pm.environment.get('is_logged_in') !== 'true') {",
                "    console.log('错误：用户未登录，此请求将失败');",
                "    return;",
                "}",
                "",
                "if (pm.environment.get('is_admin') !== 'true') {",
                "    console.log('错误：需要管理员权限，此请求将失败');",
                "}"
              ],
              "type": "text/javascript"
            }
          },
          {
            "listen": "test",
            "script": {
              "exec": [
                "// 基础响应验证",
                "pm.test('HTTP状态码验证', function () {",
                "    pm.expect([200, 401, 403]).to.include(pm.response.code);",
                "});",
                "",
                "// 响应时间验证",
                "pm.test('响应时间验证', function () {",
                "    pm.expect(pm.response.responseTime).to.be.below(3000);",
                "});",
                "",
                "// 成功获取时的验证",
                "if (pm.response.code === 200) {",
                "    pm.test('统计信息响应格式验证', function () {",
                "        const jsonData = pm.response.json();",
                "        pm.expect(jsonData).to.have.property('users');",
                "        pm.expect(jsonData).to.have.property('novels');",
                "        pm.expect(jsonData).to.have.property('characters');",
                "        pm.expect(jsonData).to.have.property('relationships');",
                "        pm.expect(jsonData).to.have.property('system');",
                "    });",
                "    ",
                "    // 验证数据类型",
                "    pm.test('统计数据类型验证', function () {",
                "        const jsonData = pm.response.json();",
                "        pm.expect(jsonData.users.total).to.be.a('number');",
                "        pm.expect(jsonData.novels.total).to.be.a('number');",
                "        pm.expect(jsonData.characters.total).to.be.a('number');",
                "        pm.expect(jsonData.relationships.byType).to.be.an('object');",
                "    });",
                "    ",
                "    // 验证数据合理性",
                "    pm.test('统计数据合理性验证', function () {",
                "        const jsonData = pm.response.json();",
                "        pm.expect(jsonData.users.total).to.be.at.least(0);",
                "        pm.expect(jsonData.users.active).to.be.at.most(jsonData.users.total);",
                "        pm.expect(jsonData.novels.inProgress + jsonData.novels.completed).to.be.at.most(jsonData.novels.total);",
                "    });",
                "}",
                "",
                "/* 业务逻辑验证：",
                "   - 验证管理员权限控制",
                "   - 检查统计数据的完整性",
                "   - 确认数据的逻辑一致性",
                "*/"
              ],
              "type": "text/javascript"
            }
          }
        ]
      },
      {
        "name": "获取所有用户列表",
        "request": {
          "method": "GET",
          "header": [],
          "url": {
            "raw": "{{base_url}}/api/admin/users?page=1&limit=20&search=",
            "query": [
              {
                "key": "page",
                "value": "1",
                "description": "页码，从1开始"
              },
              {
                "key": "limit",
                "value": "20",
                "description": "每页数量，最大100"
              },
              {
                "key": "search",
                "value": "",
                "description": "搜索关键词（用户名或邮箱）"
              }
            ]
          },
          "description": "#### 获取所有用户列表\n\n**功能说明**: 获取系统中所有用户的列表，支持分页和搜索\n\n**权限要求**: \n- 角色：管理员\n- 权限：需要管理员权限\n\n**限流规则**: \n- QPS限制：30次/秒\n- 管理员专用接口\n\n**错误码对照表**:\n\n| 错误码 | HTTP状态码 | 错误信息 | 解决方案 |\n|--------|------------|----------|----------|\n| 401 | 401 | 未登录 | 管理员需要先登录 |\n| 403 | 403 | 权限不足 | 需要管理员权限 |\n| 400 | 400 | 分页参数无效 | 检查page和limit参数 |\n| 500 | 500 | 服务器内部错误 | 联系技术支持 |\n\n**业务规则**:\n- 只有管理员可以访问\n- 支持按用户名和邮箱搜索\n- 分页查询，每页最多100条\n- 不返回用户密码等敏感信息\n- 按注册时间倒序排列"
        },
        "response": [
          {
            "name": "获取成功",
            "originalRequest": {
              "method": "GET",
              "header": [],
              "url": {
                "raw": "{{base_url}}/api/admin/users?page=1&limit=20"
              }
            },
            "status": "OK",
            "code": 200,
            "_postman_previewlanguage": "json",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-Total-Count",
                "value": "1250"
              }
            ],
            "cookie": [],
            "body": "{\n  \"users\": [\n    {\n      \"id\": 1,\n      \"username\": \"admin\",\n      \"email\": \"admin@example.com\",\n      \"isAdmin\": true,\n      \"createdAt\": \"2024-01-01T00:00:00.000Z\",\n      \"lastLoginAt\": \"2024-01-15T18:30:00.000Z\",\n      \"novelCount\": 0,\n      \"status\": \"active\"\n    },\n    {\n      \"id\": 2,\n      \"username\": \"user001\",\n      \"email\": \"user001@example.com\",\n      \"isAdmin\": false,\n      \"createdAt\": \"2024-01-10T14:20:00.000Z\",\n      \"lastLoginAt\": \"2024-01-15T16:45:00.000Z\",\n      \"novelCount\": 3,\n      \"status\": \"active\"\n    },\n    {\n      \"id\": 3,\n      \"username\": \"writer_zhang\",\n      \"email\": \"zhang@example.com\",\n      \"isAdmin\": false,\n      \"createdAt\": \"2024-01-08T09:15:00.000Z\",\n      \"lastLoginAt\": \"2024-01-14T20:30:00.000Z\",\n      \"novelCount\": 12,\n      \"status\": \"active\"\n    }\n  ],\n  \"pagination\": {\n    \"page\": 1,\n    \"limit\": 20,\n    \"total\": 1250,\n    \"totalPages\": 63\n  }\n}",
            "description": "### 用户列表成功响应\n\n**响应字段**:\n\n| 字段名 | 类型 | 描述 |\n|--------|------|------|\n| users | array | 用户信息数组 |\n| users[].id | number | 用户唯一标识 |\n| users[].username | string | 用户名 |\n| users[].email | string | 邮箱地址 |\n| users[].isAdmin | boolean | 是否为管理员 |\n| users[].createdAt | string | 注册时间 |\n| users[].lastLoginAt | string | 最后登录时间 |\n| users[].novelCount | number | 创建的小说数量 |\n| users[].status | string | 用户状态(active/suspended/banned) |\n| pagination | object | 分页信息 |\n\n**用户状态说明**:\n- active: 正常活跃用户\n- suspended: 暂时停用\n- banned: 永久封禁"
          }
        ],
        "event": [
          {
            "listen": "prerequest",
            "script": {
              "exec": [
                "// 检查管理员权限",
                "if (pm.environment.get('is_admin') !== 'true') {",
                "    console.log('错误：需要管理员权限，此请求将失败');",
                "}"
              ],
              "type": "text/javascript"
            }
          },
          {
            "listen": "test",
            "script": {
              "exec": [
                "// 基础响应验证",
                "pm.test('HTTP状态码验证', function () {",
                "    pm.expect([200, 400, 401, 403]).to.include(pm.response.code);",
                "});",
                "",
                "// 成功获取时的验证",
                "if (pm.response.code === 200) {",
                "    pm.test('用户列表响应格式验证', function () {",
                "        const jsonData = pm.response.json();",
                "        pm.expect(jsonData).to.have.property('users');",
                "        pm.expect(jsonData).to.have.property('pagination');",
                "        pm.expect(jsonData.users).to.be.an('array');",
                "    });",
                "    ",
                "    // 验证用户数据结构",
                "    const responseJson = pm.response.json();",
                "    if (responseJson.users.length > 0) {",
                "        pm.test('用户数据结构验证', function () {",
                "            const user = responseJson.users[0];",
                "            pm.expect(user).to.have.property('id');",
                "            pm.expect(user).to.have.property('username');",
                "            pm.expect(user).to.have.property('email');",
                "            pm.expect(user).to.have.property('isAdmin');",
                "            pm.expect(user).to.not.have.property('password');",
                "        });",
                "    }",
                "}",
                "",
                "/* 业务逻辑验证：",
                "   - 验证不返回敏感信息",
                "   - 检查分页功能的正确性",
                "   - 确认管理员权限控制",
                "*/"
              ],
              "type": "text/javascript"
            }
          }
        ]
      }
    ]
  }
}
